<!DOCTYPE html>
<html>
<head>
    <title>Contractor Dashboard</title>
    <script src="https://unpkg.com/@zxing/library@latest"></script>
    <style>
        #video-preview {
          width:500px;
          height:500px;
        }
    </style>
</head>
<body>
    <h1>Welcome to Contractor dashboard! {{user}}</h1>
    <h2>Select an option:</h2>
    <button onclick="location.href='/add_technician'">Join My Team</button>
    <button onclick="showPurchaseTagsForm()">Purchase Tags</button>
    <button onclick="showReplaceTagsForm()">Replace Tags</button>
    <button onclick="showDeleteTechnicianForm()">Delete Technician Account</button>
    <button onclick="location.href='/technician_details'">Technician Managment</button>
    <button id="startButton">Reclaim/Recover</button>
    <video id="video-preview"></video>
    <p id="scanResult"></p>

    <!-- Join My Team Form -->
    <!-- Other forms removed for brevity -->

    <script>
        var codeReader = new ZXing.BrowserQRCodeReader();

        function showJoinTeamForm() {
            hideAllForms();
            document.getElementById('joinTeamForm').style.display = 'block';
        }

        function showPurchaseTagsForm() {
            hideAllForms();
            document.getElementById('purchaseTagsForm').style.display = 'block';
        }

        function showReplaceTagsForm() {
            hideAllForms();
            document.getElementById('replaceTagsForm').style.display = 'block';
        }

        function showDeleteTechnicianForm() {
            hideAllForms();
            document.getElementById('deleteTechnicianForm').style.display = 'block';
        }

        function hideAllForms() {
            document.getElementById('joinTeamForm').style.display = 'none';
            document.getElementById('purchaseTagsForm').style.display = 'none';
            document.getElementById('replaceTagsForm').style.display = 'none';
            document.getElementById('deleteTechnicianForm').style.display = 'none';
        }

        document.getElementById("startButton").addEventListener("click", function () {
            codeReader.decodeFromInputVideoDevice(undefined, 'video-preview').then(function (result) {
                document.getElementById('scanResult').textContent = result.text;
                codeReader.reset();
                // Send data to server
                fetch('/handle_qr_code', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ qrCode: result.text })
                }).then(function(response) {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                }).then(function(data) {
                    console.log('Successfully sent QR code data to server: ' + data);
                }).catch(function(error) {
                    console.error('There has been a problem with your fetch operation: ', error);
                });
            }).catch(function (err) {
                console.error(err)
                document.getElementById('scanResult').textContent = 'Error: ' + err;
            });
        });
    </script>
</body>
</html>
