<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Recovery Form</title>
  <link rel="icon" type="image/png" sizes="130x165"
    href="/static/images/favicon-light.png?h=1078ffc38902e5af3330798c0cfeab0c">
  <link rel="icon" type="image/png" sizes="130x165"
    href="/static/images/favicon-dark.png?h=1078ffc38902e5af3330798c0cfeab0c" media="(prefers-color-scheme: dark)">
  <link rel="icon" type="image/png" sizes="130x165"
    href="/static/images/favicon-light.png?h=1078ffc38902e5af3330798c0cfeab0c">
  <link rel="icon" type="image/png" sizes="130x165"
    href="/static/images/favicon-dark.png?h=1078ffc38902e5af3330798c0cfeab0c" media="(prefers-color-scheme: dark)">
  <link rel="icon" type="image/png" sizes="130x165"
    href="/static/images/favicon-light.png?h=1078ffc38902e5af3330798c0cfeab0c">
  <link rel="icon" type="image/png" sizes="130x165"
    href="/static/images/favicon-light.png?h=1078ffc38902e5af3330798c0cfeab0c">
  <link rel="icon" type="image/png" sizes="348x122"
    href="/static/img/refit-logo-light.png?h=1078ffc38902e5af3330798c0cfeab0c">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="manifest" href="/manifest.json?h=1925185a4fdbc423b5c4a32f4cfda507">
  <link rel="stylesheet" href="/static/css/Inter.css?h=2b6b187577b77bbecfd8e0c0ba7be8a4">
  <link rel="stylesheet" href="/static/css/Poppins.css?h=3b3aefe71f57d702393cff5e84476a7a">
  <link rel="stylesheet" href="/static/css/bs-theme-overrides.css?h=c5ea18736f8f7fad3c119301c412bdf6">
  <link rel="stylesheet" href="/static/css/QR-Scanner.css?h=376092ebd9ede60f9d6ca2aea2b07df6">
  <link rel="stylesheet" href="/static/css/styles.css?h=0e92255a3d7da6d89898f52edb855399">
  <link rel="stylesheet" href="/static/css/test.css">

  <style>
    .light-grey-background {
      background-color: rgb(203, 203, 203);
      /* This is your light grey color */
    }
  </style>
</head>

<body>

  <div class="d-flex justify-content-center mt-5">
    <div class="d-flex justify-content-center align-items-center">
      <div class="px-4">
        <h1>Refrigerant Recovery Form</h1>
        <div>
          <table class="table">
            <thead>
              <tr>
                <th>Cylinder Tag ID</th>
                <th>Refrigerant Name</th>
                <th>Technician ID</th>
                <th>Cylinder Type</th>
                <th>Cylinder Weight BEFORE recovery (lbs):</th>
                <th>Current Refrigerant Weight (oz)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>{{dt.tag}}</td>
                <td>{{dt.name}}</td>
                <td>{{dt.tech_id}}</td>
                <td>{{dt.type}}</td>
                <td id="tare_weight_before_repair">{{dt.tare_weight_before_repair}}</td>
                <td>{{dt.weight}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="d-flex justify-content-center align-items-center">
    <!-- Adjust the height as needed -->
    <form id="myForm" method="post" action="/refrigerant_recovery">
      <h1>User Input</h1>
      <label for="createDate" class="form-label">Date:</label> 
      <input type="date" id="createDate" name="createDate" value="{{dt.date}}" class="form-control mb-3" required>

      <label for="cylinder_weight_after_service" class="form-label">Cylinder Weight AFTER service:</label>
      <input type="number" id="cylinder_weight_after_service" name="cylinder_weight_after_service" value=""
        class="form-control" required>
      <div id="error-message-container" style="max-width: 300px; word-wrap: break-word;">
      <span id="error-message" style="color: red;"></span> <!-- Error message span -->
      </div>
      <label for="refrigerantWeightAfterService" class="form-label">Refrigerant Weight Recovered
        (lbs):</label>
      <input type="number" id="refrigerantWeightAfterService" name="refrigerantWeightAfterService" value=""
        class="form-control light-grey-background" readonly>

      <div class="col">
        <div class="d-grid gap-4 mx-auto mt-3 mb-5">
          <button type="submit" class="btn btn-primary btn-lg">Submit</button>
        </div>
      </div>
    </form>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('myForm');
      const errorMessageContainer = document.getElementById('error-message-container');
      form.addEventListener('submit', function (event) {
        // Check if the error message is displayed
        if (errorMessageContainer.textContent.trim() !== '') {
            event.preventDefault(); // Prevent form submission
            alert('Please correct the errors before submitting.');
        }
    });


      document.getElementById('createDate').value = new Date().toISOString().split('T')[0];

      document.getElementById('cylinder_weight_after_service').addEventListener('input', function () {
        const currentWeightText = document.getElementById('tare_weight_before_repair').textContent || '0';
        const currentWeight = parseFloat(currentWeightText);
        const reclaimedWeight = parseFloat(this.value) || 0;

        // Validation check
        if (reclaimedWeight <= currentWeight) {
          document.getElementById('error-message').textContent = "Cylinder weight AFTER refrigerant recovery cannot be less than BEFORE service.";
          document.getElementById('refrigerantWeightAfterService').value = '';
        } else {
          document.getElementById('error-message').textContent = '';
          document.getElementById('refrigerantWeightAfterService').value = (reclaimedWeight - currentWeight).toFixed(2);
        }
      });
    });
  </script>
</body>