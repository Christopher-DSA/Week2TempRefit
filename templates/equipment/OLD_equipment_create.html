<!DOCTYPE html>
<html>
<head>
    <title>Equipment Create (NEW)</title>
</head>
<body>
    <h1>Equipment Create</h1>
    <form id="equipmentForm" method="post" action="/equipment/equipment_create">  <!--onsubmit="submitForm(event)-->
        <h2>Profile Info</h2>  
        <label for="equipmentTagId">Equipment Tag ID:</label>
        <input type="text" id="equipmentTagId" name="equipmentTagId" value="EQUIP001" readonly> 

        <label for="technicianId">Technician ID:</label>
        <input type="text" id="technicianId" name="technicianId" value="TECH001" readonly>

        <label for="createDate">Create Date:</label>
        <input type="date" id="createDate" name="createDate" required>

        <label for="address">Address:</label>
        <input type="text" id="address" name="address" required>

        <label for="organizationId">Store ID:</label>
        <input type="text" id="organizationId" name="organizationId">

        <label for="refrigerantType">Refrigerant Type:</label>
        <select id="refrigerantType" name="refrigerantType" onchange="updateRefrigerantIdAndTotalCharge()" required>
            <option value="" selected disabled>Select refrigerant type</option>
            <option value="R134a">R134a</option>
            <option value="R410a">R410a</option>
            
        </select>

        <label for="refrigerantId">Refrigerant ID (no need for this):</label>
        <input type="text" id="refrigerantId" name="refrigerantId" readonly>

        <label for="factoryCharge">Factory Charge (lbs):</label>
        <input type="number" id="factoryCharge" name="factoryCharge" required>

        <label for="additionalCharge">Additional Refrigerant Charge (lbs)(no need for this):</label>
        <input type="number" id="additionalCharge" name="additionalCharge" required>

        <label for="totalCharge">Total Refrigerant Charge (lbs) (no need for this):</label>
        <input type="number" id="totalCharge" name="totalCharge" readonly>

        <h2>Equipment Details</h2>
        <label for="manufacturerName">Manufacturer's Name:</label>
        <input type="text" id="manufacturerName" name="manufacturerName" required>

        <label for="modelNumber">Model Number:</label>
        <input type="text" id="modelNumber" name="modelNumber" required>

        <label for="serialNumber">Serial Number:</label>
        <input type="text" id="serialNumber" name="serialNumber" required>

        <label for="equipmentType">Equipment Type:</label>
        <input type="text" id="equipmentType" name="equipmentType" required>

        <label for="addRefrigerant">Add Additional Refrigerant:</label>
        <select id="addRefrigerant" name="addRefrigerant" onchange="toggleAdditionalRefrigerantInput()">
            <option value="no" selected>No</option>
            <option value="yes">Yes</option>
        </select>

        <div id="additionalRefrigerantSection" style="display: none;">
            <label for="additionalRefrigerantAmount">Additional Refrigerant Amount (lbs):</label>
            <input type="number" id="additionalRefrigerantAmount" name="additionalRefrigerantAmount" required>

            <label for="locationDescription">Location Description:</label>
            <input type="text" id="locationDescription" name="locationDescription" required>
        </div>

        <label for="additionalNotes">Additional Notes:</label>
        <textarea id="additionalNotes" name="additionalNotes" rows="4" cols="50"></textarea>

        <button type="submit">Create</button>
    </form>

    <script>
        function updateRefrigerantIdAndTotalCharge() {
            const selectedRefrigerant = document.getElementById('refrigerantType').value;
            const refrigerantId = "REF001";
            document.getElementById('refrigerantId').value = refrigerantId;
            const factoryCharge = parseFloat(document.getElementById('factoryCharge').value);
            const additionalCharge = parseFloat(document.getElementById('additionalCharge').value);
            const totalCharge = factoryCharge + additionalCharge;
            document.getElementById('totalCharge').value = totalCharge;
        }

        function toggleAdditionalRefrigerantInput() {
            const addRefrigerantValue = document.getElementById('addRefrigerant').value;
            const additionalRefrigerantSection = document.getElementById('additionalRefrigerantSection');
            if (addRefrigerantValue === 'yes') {
                additionalRefrigerantSection.style.display = 'block';
            } else {
                additionalRefrigerantSection.style.display = 'none';
            }
        }

        function submitForm(event) {
            //event.preventDefault();

            // Get the user's location
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(sendLocation);
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }

        function sendLocation(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;

            // Display the coordinates on the page
            document.getElementById("locationOutput").innerText = `Received coordinates: Latitude ${latitude}, Longitude ${longitude}`;

            // Send the data to Flask
            fetch('equipment/equipment_create', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `latitude=${latitude}&longitude=${longitude}`
            })
            .then(response => response.text())
            .then(data => {
                console.log(data);
                // Here you can redirect or do anything else after sending the data to Flask
            });
        }
    </script>
</body>
</html>

