<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equipment Create (NEW)</title>

    <!-- Add Select2 CSS and jQuery -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>

    <script>
        // Function to set the current date as default
        function setCurrentDate() {
            var today = new Date();
            var dd = String(today.getDate()).padStart(2, '0');
            var mm = String(today.getMonth() + 1).padStart(2, '0');
            var yyyy = today.getFullYear();

            today = yyyy + '-' + mm + '-' + dd;
            document.getElementById('createDate').value = today;
        }

        // Call the function when the window loads
        window.onload = setCurrentDate;

        // Fetch the CSV file
        fetch('/refrigerantTypeLookupData')
            .then(response => response.text())
            .then(csvData => {
                // Parse CSV data
                const rows = csvData.split('\n').slice(1); // Remove header row
                const select2Data = rows.map(row => {
                    const [id, name] = row.split(',');
                    return { id, text: name };
                });

                // Initialize Select2 on the refrigerantType dropdown
                $('#refrigerantType').select2({
                    data: select2Data,
                    placeholder: 'Select refrigerant type',
                    allowClear: true,
                    width: '20%'
                });
            })
            .catch(error => console.log('Error fetching the CSV file:', error));

        function updateRefrigerantIdAndTotalCharge() {
            // Get the selected value from the dropdown
            const selectedValue = $('#refrigerantType').val();
            console.log('Selected value:', selectedValue);
        }
    </script>
</head>
<body>
    <h1>Equipment Create (NEW, do not edit this page please. In testing.)</h1>
    <form id="equipmentForm" method="post" action="/equipment/equipment_create">
        <h2>Profile Info (will add this later)</h2>
        <label for="technicianId">Technician ID:</label>
        <input type="text" id="technicianId" name="technicianId" value="TECH-{{tech_id}}" readonly>
        <br>
        <h2>Equipment Details</h2>
        <label for="createDate">Create Date:</label>
        <input type="date" id="createDate" name="createDate" required>

        <label for="refrigerantType">Refrigerant Type:</label>
        <select id="refrigerantType" name="refrigerantType" onchange="updateRefrigerantIdAndTotalCharge()" required>
            <!-- Options will be dynamically added through JavaScript -->
        </select>

        <label for="factoryCharge">Factory Charge (lbs)*:</label required>
        <input type="number" id="factoryCharge" name="factoryCharge">

        <label for="manufacturerName">Manufacturer's Name*:</label>
        <input type="text" id="manufacturerName" name="manufacturerName" required>

        <br>
        <label for="serialNumber">Serial Number*:</label>
        <input type="text" id="serialNumber" name="serialNumber" required>

        <label for="equipmentType">Equipment Type*:</label>
        <input type="text" id="equipmentType" name="equipmentType" required>

        <button type="submit">Submit</button>
    </form>
</body>
</html>
